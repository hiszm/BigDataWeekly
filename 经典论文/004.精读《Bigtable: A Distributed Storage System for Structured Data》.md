
![](https://github.com/user-attachments/assets/475ab40b-789e-4fc8-b10d-184bf195f801)




[toc]

## 1. å¼•è¨€ï¼š
åœ¨æœ¬æœŸçš„ç²¾è¯»ä¼šä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥è§£è¯»å¦ä¸€ç¯‡å…·æœ‰é‡Œç¨‹ç¢‘æ„ä¹‰çš„è®ºæ–‡â€”â€”ã€ŠBigtable: A Distributed Storage System for Structured Dataã€‹ã€‚è¿™ç¯‡è®ºæ–‡è¯¦ç»†ä»‹ç»äº† `Bigtable` ä½œä¸ºè°·æ­Œç”¨äºç®¡ç†ç»“æ„åŒ–æ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œå…¶ç‹¬ç‰¹çš„è®¾è®¡ä½¿å¾— `Bigtable` èƒ½å¤Ÿåœ¨æ•°åƒå°æœåŠ¡å™¨ä¸Šé«˜æ•ˆåœ°å¤„ç† PB çº§æ•°æ®é‡ã€‚ä½œä¸ºè°·æ­Œå¤šä¸ªæ ¸å¿ƒäº§å“çš„åŸºç¡€æ¶æ„ï¼Œ`Bigtable` åœ¨å¤§è§„æ¨¡æ•°æ®å¤„ç†ã€åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿè®¾è®¡ä¸­å…·æœ‰é‡è¦çš„å‚è€ƒæ„ä¹‰ã€‚

é€šè¿‡æœ¬æ–‡ï¼Œæˆ‘ä»¬å°†å¸¦é¢†è¯»è€…ï¼š

1. æ¢è®¨ **Bigtable** åœ¨ Googleè¯ç”Ÿçš„**èƒŒæ™¯**ï¼Œå…¶å‡ºç°ç©¶ç«Ÿæ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼›
2. æ·±å…¥å‰–æ **Bigtable çš„æ•°æ®æ¨¡å‹** å’Œå…¶è®¾è®¡å¦‚ä½•å®ç°çµæ´»çš„å­˜å‚¨å’Œè®¿é—®æ§åˆ¶ï¼›
3. è§£æ **Bigtable** åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„ å®ç°è¿‡ç¨‹**åº•å±‚æ•°æ®ç»“æ„**ï¼›
4. å±•æœ› Bigtable å¯¹ **å¤§æ•°æ®å­˜å‚¨ç³»ç»Ÿ** çš„å½±å“åŠå…¶æœªæ¥å¯èƒ½çš„å‘å±•æ–¹å‘ã€‚

æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«æ‚¨çš„è§‚ç‚¹ä¸è§è§£ï¼ŒæœŸå¾…ä¸æ‚¨äº¤æµè®¨è®ºï¼
## 2. ç²¾è¯»
### 2.1 èƒŒæ™¯

åœ¨ `GFS` å’Œ `MapReduce`å‡ºç°åï¼Œä»ç„¶å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰åœ¨å¤§å‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸Šå¯ä»¥é«˜å¹¶å‘ã€ä¿éšœä¸€è‡´æ€§ï¼Œå¹¶ä¸”æ”¯æŒéšæœºè¯»å†™æ•°æ®çš„ç³»ç»Ÿã€‚

å½“ç„¶åœ¨æœ¬ç¯‡è®ºæ–‡å‡ºç°ä¹‹å‰ï¼Œå¤§å¤šæ•°çš„åˆ†å¸ƒå¼æ•°æ®éƒ½æ˜¯é€šè¿‡`MySQL`æ¥å®ç°å¯¹å¤§è§„æ¨¡æ•°æ®çš„ç®¡ç†çš„ã€‚å¦‚æœåªæ˜¯ç»´æŠ¤ä¸€ä¸ªå‡ åä¹ƒè‡³å‡ ç™¾å°æœåŠ¡å™¨çš„ `MySQL` é›†ç¾¤å…¶å®ä¹Ÿå¹¶ä¸ä¸ºè¿‡ï¼Œä½†æ˜¯ï¼Œå¦‚æœè¦åƒ` GFS` ç»´æŠ¤æˆåƒä¸Šä¸‡çš„æœåŠ¡å™¨ï¼Œè¿˜æœ‰èƒ½åšåˆ°å—ï¼Ÿæˆ‘ä»¬å¯ä»¥ç®€å•çš„çœ‹ä¸€ä¸‹ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å»ºç«‹ä¸€ä¸ª`MySQL`é›†ç¾¤æ¥ç®¡ç†å…¨å›½çš„äººå£ä¿¡æ¯ï¼Œå¯ä»¥é‡‡ç”¨**å‚ç›´**æ‹†åˆ†å’Œ**æ°´å¹³**æ‹†åˆ†ä¸¤ç§ç­–ç•¥æ¥è¿›è¡Œåˆ†å¸ƒå¼æ•°æ®ç®¡ç†ã€‚


![image](https://github.com/user-attachments/assets/6044bffc-acfd-4ed4-8094-a885b3f158f8)


> é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§æ•°æ®åº“ä¸­çš„è¡¨æŒ‰ç…§ä¸šåŠ¡é€»è¾‘è¿›è¡Œæ‹†åˆ†ï¼Œæ¯ä¸ªæ‹†åˆ†å‡ºæ¥çš„æ•°æ®åº“ï¼ˆæˆ–å®ä¾‹ï¼‰åŒ…å«ä¸€éƒ¨åˆ†è¡¨ã€‚è¿™ç§æ‹†åˆ†æ–¹å¼é€‚ç”¨äºä¸šåŠ¡æ¨¡å—ä¹‹é—´è€¦åˆåº¦è¾ƒä½çš„æƒ…å†µã€‚å¯¹äºå…¨å›½äººå£ä¿¡æ¯ç®¡ç†ï¼Œå¯ä»¥æŒ‰ç…§ä¸åŒçš„ä¸šåŠ¡æ¨¡å—ï¼ˆå¦‚æˆ·ç±ç®¡ç†ï¼‰è¿›è¡Œå‚ç›´æ‹†åˆ†ã€‚ä¾‹å¦‚ï¼šä¸­å›½ç›®å‰æœ‰34ä¸ªçœçº§è¡Œæ”¿åŒºï¼Œé‚£ä¹ˆå°±å¯ä»¥æŒ‰ç…§æ¯ä¸ªçœçº§è¡Œæ”¿æ€§æ‹†ä¸€å¼ è¡¨è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å•ä¸ªæ•°æ®åº“çš„å¹¶å‘å‹åŠ›ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚

> ä½†æ˜¯æˆ‘ä»¬åˆä¼šå‘ç°ä¸åŒçœçº§è¡Œæ”¿åŒºçš„äººå£æ•°é‡è¿˜ä¸ä¸€è‡´ï¼Œä¸­è¥¿éƒ¨äººå£æ™®éå°‘ä¸€äº›ä¸€å¼ è¡¨å¯èƒ½å¤Ÿç”¨ï¼Œè€Œæ²¿æµ·å¤šä¸€äº›å¯èƒ½å°±ä¸å¤Ÿç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è¿›è¡Œæ°´å¹³æ‹†åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿›è¡Œæ°´å¹³æ‹†åˆ†ï¼Œå°†å•å¼ è¡¨çš„æ•°æ®æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ†å¸ƒåˆ°å¤šä¸ªæ•°æ®åº“æˆ–è¡¨ä¸­ï¼Œæ¯ä¸ªè¡¨ä»…åŒ…å«æ•°æ®çš„ä¸€éƒ¨åˆ†ã€‚å¯¹äºå…¨å›½äººå£ä¿¡æ¯ç®¡ç†ï¼Œå¯ä»¥æŒ‰ç…§åœ°åŸŸã€æ—¶é—´æˆ–å…¶ä»–ä¸šåŠ¡è§„åˆ™ï¼ˆå¦‚Hashã€Rangeç­‰ï¼‰å°†äººå£ä¿¡æ¯æ•°æ®åˆ†å¸ƒåˆ°ä¸åŒçš„æ•°æ®åº“æˆ–è¡¨ä¸­ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥æŒ‰ç…§èº«ä»½è¯ä¿¡æ¯å¯¹4å–æ¨¡ï¼Œç„¶åæ¯ä¸ªçœçº§è¡Œæ”¿åŒºå¯ä»¥å‡åŒ€çš„åˆ†é…åˆ°ä¸åŒçš„å››å¼ è¡¨é‡Œé¢ã€‚

> åæœŸç»´æŠ¤æ€ä¹ˆæ ·å‘¢ï¼Œå¦‚æœé‡åˆ°å¦‚ä¸Šä¸–çºªå…­ä¸ƒåå¹´ä»£çš„ç”Ÿè‚²æ½®ï¼Œæˆ‘ä»¬ç»§ç»­å¯¹æ•°æ®è¿›è¡Œæ‰©å®¹ã€‚å¦‚æœæˆ‘ä»¬åªå¢åŠ  2 å°æœåŠ¡å™¨ï¼ŒæŠŠå„ä¸ªæœåŠ¡å™¨çš„åˆ†ç‰‡ï¼Œä»æ¨¡ä¸Š 4 å˜æˆæ¨¡ä¸Š 6ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨å¢åŠ æœåŠ¡å™¨ä¹‹åï¼Œæ¬è¿å¤§é‡çš„æ•°æ®ï¼Œè€Œæ•°æ®è¿ç§»æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°å¸¦å®½å’Œå­˜å‚¨å‹åŠ›ã€æœåŠ¡ä¸­æ–­ã€è¯»å†™å¤æ‚æ€§å¢åŠ ã€èµ„æºæµªè´¹å’Œæˆæœ¬é—®é¢˜ã€‚åŒæ—¶ç¼©å®¹çš„æƒ…å†µä¹Ÿæ˜¯ï¼Œå…¶é›†ç¾¤çš„â€œä¼¸ç¼©æ€§â€å¤ªå·®ï¼Œä»¥åŠåé¢çš„ç»´æŠ¤æ€§å·¥ä½œä¹Ÿä¸å°‘ã€‚


æ‰€ä»¥ï¼Œ`Bigtable`çš„è®¾è®¡ç›®æ ‡å°±æœ‰äº†ï¼š

1. **çµæ´»çš„èµ„æºç®¡ç†**ï¼šèƒ½å¤Ÿæ ¹æ®å®æ—¶éœ€æ±‚ï¼Œéšæ—¶å¢åŠ æˆ–å‡å°‘æœåŠ¡å™¨æ•°é‡ï¼Œä»¥é€‚åº”ä¸šåŠ¡é«˜å³°æœŸå’Œä½è°·æœŸçš„å˜åŒ–ï¼Œå®ç°é«˜æ•ˆèµ„æºåˆ©ç”¨ã€‚

2. **æ™ºèƒ½çš„æ•°æ®åˆ†ç‰‡**ï¼šç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨æ ¹æ®æ•°æ®è´Ÿè½½è¿›è¡Œåˆ†ç‰‡ï¼Œå½“æŸä¸ªåˆ†ç‰‡è´Ÿè½½è¿‡é«˜æ—¶ï¼Œè‡ªåŠ¨æ‹†åˆ†ä»¥å¹³è¡¡è´Ÿè½½ï¼›åŒæ—¶ï¼Œåœ¨æ·»åŠ æ–°æœåŠ¡å™¨åï¼Œèƒ½å¤Ÿè¿…é€Ÿé‡æ–°åˆ†é…æ•°æ®ï¼Œç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹å‡è¡¡æ‰¿æ‹…å‹åŠ›ã€‚

3. **é«˜å¯ç”¨æ€§**ï¼šå³ä½¿éƒ¨åˆ†èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œé›†ç¾¤ä»èƒ½ç»§ç»­è¿è¡Œï¼Œç¡®ä¿æ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚




ç°åœ¨å°±å¼•å…¥æœ¬æ–‡ä¸»è§’ï¼šBigtable æ˜¯ä¸€ä¸ª**åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ**ï¼Œç”¨äºç®¡ç†**ç»“æ„åŒ–æ•°æ®**ï¼Œè®¾è®¡å¯ä»¥æ‰©å±•åˆ°æå¤§çš„è§„æ¨¡ï¼Œæ¶µç›–**PBçº§æ•°æ®**å¹¶åˆ†å¸ƒåœ¨**æ•°åƒå°é€šç”¨æœåŠ¡å™¨**ä¸Šã€‚

ä¼—å¤š Google äº§å“ï¼ŒåŒ…æ‹¬**ç½‘é¡µç´¢å¼•**ã€**Google Earth** å’Œ **Google Finance**ï¼Œéƒ½ä½¿ç”¨ Bigtable è¿›è¡Œæ•°æ®å­˜å‚¨ã€‚å°½ç®¡è¿™äº›åº”ç”¨å¯¹ Bigtable çš„éœ€æ±‚å·®å¼‚å¾ˆå¤§â€”â€”æ— è®ºæ˜¯ä»**æ•°æ®å¤§å°**ï¼ˆä» URL åˆ°ç½‘é¡µï¼Œå†åˆ°å«æ˜Ÿå›¾åƒï¼‰è¿˜æ˜¯**å»¶è¿Ÿè¦æ±‚**ï¼ˆä»åå°æ‰¹é‡å¤„ç†åˆ°å®æ—¶æ•°æ®æœåŠ¡ï¼‰æ¥çœ‹ï¼ŒBigtable ä¾ç„¶ä¸ºè¿™äº›äº§å“æä¾›äº†ä¸€ä¸ª**çµæ´»ä¸”é«˜æ€§èƒ½çš„è§£å†³æ–¹æ¡ˆ**ã€‚

å®é™…ä¸Šï¼ŒBigtable å¹¶ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„â€œè¡¨ï¼ˆ`table`ï¼‰â€ã€‚åœ¨å…¶åº•å±‚ï¼Œæ•°æ®çš„ç‰©ç†å­˜å‚¨å½¢å¼æ˜¯ä¸€ä¸ª**æ’åºçš„ Map**ã€‚è¯¥ `Map` çš„ `key` ç”±**è¡Œå…³é”®å­—**ã€**åˆ—å…³é”®å­—**å’Œ**æ—¶é—´æˆ³**ç»„æˆçš„å¤åˆç»“æ„ï¼Œè€Œ `value` åˆ™æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼š`(row:string, column:string, time:int64) â†’ string`ã€‚

Bigtable æä¾›äº†ä¸€ä¸ª**ç®€å•çš„æ•°æ®æ¨¡å‹**ï¼Œå…è®¸å®¢æˆ·ç«¯**åŠ¨æ€æ§åˆ¶æ•°æ®çš„å¸ƒå±€å’Œæ ¼å¼**ï¼Œä»è€Œæ»¡è¶³å„ç§åº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚

### 2.2 æ•°æ®æ¨¡å‹

æ‰€ä»¥ä¸ºäº†è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼Œ Bigtableè®¾è®¡äº†ä¸€ä¸ªæ•°æ®æ¨¡å‹ï¼šä¸€ä¸ª**ç¨€ç–ã€åˆ†å¸ƒå¼ã€æŒä¹…çš„å¤šç»´æœ‰åºæ˜ å°„è¡¨**ï¼ˆmapï¼‰ï¼Œæ•°æ®é€šè¿‡**è¡Œé”®**ã€**åˆ—é”®**å’Œ**æ—¶é—´æˆ³**è¿›è¡Œç´¢å¼•ã€‚è¡¨ä¸­çš„æ¯ä¸ªæ•°æ®é¡¹éƒ½æ˜¯ä¸ä½œç†è§£çš„å­—èŠ‚æ•°ç»„ï¼Œæ˜ å°„å…³ç³»ä¸ºï¼š
`(row:string, column:string, time:int64) â†’ string`

> A Bigtable is a sparse, distributed, persistent multidimensional sorted map. The map is indexed by a row key, column key, and a timestamp; each value in the map is an uninterpreted array of bytes.




![image](https://github.com/user-attachments/assets/d7377688-c07b-4b46-b45d-1951022eb005)



åœ¨ Bigtable ä¸­ï¼Œæ¯æ¡æ•°æ®éƒ½é€šè¿‡ä¸€ä¸ªè¡Œé”®ï¼ˆ`Row Key`ï¼‰è¿›è¡Œæ ‡è¯†ï¼Œè¿™ç›¸å½“äºæ•°æ®åº“çš„**ä¸»é”®**ã€‚Bigtable æä¾›äº†é€šè¿‡è¡Œé”®è¿›è¡Œéš**æœºè¯»å†™çš„æ¥å£**ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¾ˆå¤šäººå°†è¿™ç§æ•°æ®åº“ç§°ä¸º KVï¼ˆé”®å€¼ï¼‰æ•°æ®åº“çš„åŸå› ã€‚

æ¯ä¸€è¡Œæ•°æ®éœ€è¦æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªåˆ—æ—ï¼ˆ`Column Family`ï¼‰ã€‚åœ¨è¿™äº›åˆ—æ—ä¸‹ï¼Œä½ æ— éœ€é¢„å…ˆå®šä¹‰å…·ä½“çš„åˆ—ï¼ˆ`Column`ï¼‰ã€‚è¿™æ„å‘³ç€æ¯ä¸€è¡Œæ•°æ®å¯ä»¥æ‹¥æœ‰ä¸åŒçš„åˆ—é›†ï¼Œåˆ—çš„å­˜åœ¨ä¸å¦å–å†³äºæ˜¯å¦æœ‰å€¼ã€‚å¦‚æœæŸä¸ªåˆ—æ²¡æœ‰å€¼ï¼Œé‚£ä¹ˆåœ¨åº•å±‚å­˜å‚¨ä¸­å°±ä¸ä¼šè®°å½•è¿™ä¸ªåˆ—ã€‚è¿™ç§ç‰¹æ€§ä½¿å¾— Bigtable æˆä¸ºä¸€ç§â€œç¨€ç–â€è¡¨ã€‚

Bigtable å…è®¸åœ¨åˆ—ä¸‹å­˜å‚¨å¤šä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œæ¯ä¸ªç‰ˆæœ¬éƒ½é™„å¸¦æœ‰æ—¶é—´æˆ³ï¼ˆ`Timestamp`ï¼‰ã€‚ä½ å¯ä»¥é€‰æ‹©ä¿ç•™æœ€è¿‘çš„ N ä¸ªç‰ˆæœ¬ï¼Œæ¯”å¦‚ä¿ç•™æ—¶é—´æˆ³æœ€è¿‘çš„ä¸‰ä¸ªç‰ˆæœ¬ï¼›æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å®šä¿ç•™æŸä¸ªæ—¶é—´ç‚¹ä¹‹åçš„æ‰€æœ‰ç‰ˆæœ¬ã€‚è¿™ç§çµæ´»çš„ç‰ˆæœ¬ç®¡ç†ä¸ºæ•°æ®çš„å†å²è¿½è¸ªä¸æ¢å¤æä¾›äº†ä¾¿åˆ©ã€‚


![image](https://github.com/user-attachments/assets/d67467ad-cb6b-4ba5-b203-de714e947d9d)



ä¸¾ä¸ªä¾‹å­ï¼šåˆ›å»ºäº†ä¸€ä¸ªè¡¨ï¼Œç§°ä¹‹ä¸º **Webtable**ï¼Œåœ¨ **Webtable** ä¸­ï¼Œä½¿ç”¨ç½‘é¡µçš„ **URL** ä½œä¸ºè¡Œé”®ï¼Œç½‘é¡µçš„æŸäº›ä¿¡æ¯ä½œä¸ºåˆ—é”®ã€‚ç½‘é¡µå†…å®¹å­˜å‚¨åœ¨ **contents:** åˆ—ä¸­ï¼Œå¹¶ä¸”æ¯æ¬¡æŠ“å–æ—¶è®°å½•ç›¸åº”çš„æ—¶é—´æˆ³ã€‚æœ€ç»ˆçš„å­˜å‚¨å¸ƒå±€å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚

- **è¡Œç´¢å¼•**ï¼šä½¿ç”¨ URL ä½œä¸ºè¡Œé”®ã€‚
 - **contents: åˆ—**ï¼šå­˜å‚¨é¡µé¢å†…å®¹ï¼ˆpage contentï¼‰ã€‚
  - **anchor:** å¼€å¤´çš„åˆ—ï¼šå­˜å‚¨å¼•ç”¨äº†è¯¥é¡µé¢çš„ anchorï¼ˆHTML é”šç‚¹ï¼‰çš„æ–‡æœ¬ï¼ˆtext of the anchors that reference this pageï¼‰ã€‚

å¦‚å›¾æ‰€ç¤ºï¼ŒCNN çš„ä¸»é¡µè¢« **Sports Illustrated**ï¼ˆcnnsi.comï¼‰å’Œ **MY-look** ä¸»é¡µï¼ˆmy.look.caï¼‰å¼•ç”¨ï¼Œå› æ­¤è¡¨ä¸­æœ‰ **anchor:cnnsi.com** å’Œ **anchor:my.look.ca** ä¸¤åˆ—ï¼Œæ¯åˆ—åŒ…å«ä¸€ä¸ªç‰ˆæœ¬ã€‚ä¸æ­¤åŒæ—¶ï¼Œ**contents:** åˆ—æœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼Œæ—¶é—´æˆ³åˆ†åˆ«ä¸º **t3**ã€**t5** å’Œ **t6**ã€‚

>è¡Œé”®ï¼ˆ`Row Key`ï¼‰

**è¡Œé”®ï¼ˆrow keyï¼‰** åœ¨ Bigtable ä¸­å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œå½“å‰æœ€å¤§æ”¯æŒ 64KBï¼Œå¤§å¤šæ•°ç”¨æˆ·çš„è¡Œé”®é•¿åº¦åœ¨ 10-100 å­—èŠ‚ä¹‹é—´ã€‚å¯¹äºåŒä¸€è¡Œçš„**è¯»å†™æ“ä½œæ˜¯åŸå­çš„**ï¼Œæ— è®ºè¯¥è¡Œæ¶‰åŠå¤šå°‘åˆ—ï¼ŒåŸå­æ€§è®¾è®¡ç¡®ä¿äº†åœ¨å¤šä¸ªå®¢æˆ·ç«¯å¹¶å‘æ›´æ–°åŒä¸€è¡Œæ—¶ï¼Œç³»ç»Ÿè¡Œä¸ºçš„å¯é¢„è§æ€§ã€‚

**æ•°æ®ç»„ç»‡** ä¸Šï¼ŒBigtable æ ¹æ®è¡Œé”®çš„**è¯å…¸é¡ºåºï¼ˆlexicographic orderï¼‰**è¿›è¡Œå­˜å‚¨ï¼Œå¹¶ä¼šæ ¹æ®éœ€è¦**åŠ¨æ€åˆ‡åˆ†è¡ŒèŒƒå›´ï¼ˆrow rangeï¼‰**ã€‚æ¯ä¸ªè¡ŒèŒƒå›´ç§°ä¸ºä¸€ä¸ª **tablet**ï¼Œå®ƒæ˜¯åˆ†å¸ƒå’Œè´Ÿè½½å‡è¡¡çš„åŸºæœ¬å•ä½ã€‚å› æ­¤ï¼Œè¯»å–è¾ƒå°çš„è¡ŒèŒƒå›´é€šå¸¸éå¸¸é«˜æ•ˆï¼Œåªéœ€ä¸å°‘é‡æœºå™¨è¿›è¡Œé€šä¿¡å³å¯ã€‚å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡åˆç†é€‰æ‹©è¡Œé”®ï¼Œä¼˜åŒ–æ•°æ®è®¿é—®çš„**æœ¬åœ°æ€§ï¼ˆlocalityï¼‰**ã€‚

ä¾‹å¦‚ï¼Œåœ¨ **Webtable** ä¸­ï¼Œé€šè¿‡ç¿»è½¬ URL çš„ **hostname** å­—æ®µï¼Œæ¥è‡ªåŒä¸€åŸŸåçš„é¡µé¢å°†ä¼šå­˜å‚¨åœ¨è¿ç»­çš„è¡Œä¸­ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ`maps.google.com/index.html` çš„è¡Œé”®ä¼šå­˜å‚¨ä¸º `com.google.maps/index.html`ã€‚è¿™ç§å­˜å‚¨æ–¹å¼ä¸ä»…ä¼˜åŒ–äº†å­˜å–æ•ˆç‡ï¼Œè¿˜ä½¿å¾—é’ˆå¯¹ä¸»æœºå’ŒåŸŸçš„åˆ†æï¼ˆhost and domain analysesï¼‰å˜å¾—æ›´åŠ é«˜æ•ˆã€‚



> åˆ—æ—ï¼ˆ`Column Family`ï¼‰

åˆ—æ—`column key` çš„æ ¼å¼ï¼š`family:qualifier`
- `family` å¿…é¡»ä¸ºå¯æ‰“å°çš„ï¼ˆ`printable`ï¼‰å­—ç¬¦ä¸²ï¼Œ 
- `qualifier`ï¼ˆä¿®é¥°ç¬¦ï¼‰å¯ä»¥ä¸ºä»»æ„å­—ç¬¦ä¸²ã€‚

å¤šä¸ª `column keys` å¯ä»¥ç»„ç»‡æˆ `column families`ï¼ˆåˆ—æ—ï¼‰ã€‚ `column family` æ˜¯è®¿é—®æ§åˆ¶ï¼ˆ`access control`ï¼‰çš„åŸºæœ¬å•ä½ã€‚

> æ—¶é—´æˆ³ï¼ˆ`Timestamp`ï¼‰

åœ¨ Bigtable ä¸­ï¼Œæ¯ä¸ªæ•°æ®é¡¹å¯ä»¥å­˜å‚¨å¤šä¸ªç‰ˆæœ¬ï¼Œä½¿ç”¨**æ—¶é—´æˆ³**è¿›è¡Œç´¢å¼•ã€‚
- æ—¶é—´æˆ³ä¸ºä¸€ä¸ª 64 ä½æ•´æ•°ï¼Œæ—¢å¯ä»¥ç”± Bigtable è‡ªåŠ¨ç”Ÿæˆï¼ˆè¡¨ç¤ºæ¯«ç§’çº§çš„çœŸå®æ—¶é—´æˆ³ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”±å®¢æˆ·ç«¯åº”ç”¨è‡ªè¡ŒæŒ‡å®šã€‚ä¸ºäº†é¿å…å†²çªï¼Œå®¢æˆ·ç«¯å¿…é¡»ç¡®ä¿æ—¶é—´æˆ³çš„å”¯ä¸€æ€§ã€‚
  
ä¸åŒç‰ˆæœ¬çš„æ•°æ®æŒ‰ç…§æ—¶é—´æˆ³**é™åº**å­˜å‚¨ï¼Œç¡®ä¿æ¯æ¬¡è¯»å–æ—¶ï¼Œæœ€æ–°ç‰ˆæœ¬æ€»æ˜¯ä¼˜å…ˆè¿”å›ã€‚

ä¸ºäº†ç®€åŒ–ç‰ˆæœ¬åŒ–æ•°æ®çš„ç®¡ç†ï¼Œ`Bigtable` æä¾›äº†ä¸¤ä¸ªé…ç½®é€‰é¡¹ï¼Œä½¿ç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨æ‰§è¡Œåƒåœ¾å›æ”¶ï¼ˆ`GC`ï¼‰ã€‚å®¢æˆ·ç«¯å¯ä»¥æŒ‡å®šï¼š
- **ä¿ç•™æœ€æ–°çš„ N ä¸ªç‰ˆæœ¬**ï¼›
- **ä¿ç•™æŒ‡å®šæ—¶é—´æ®µå†…çš„ç‰ˆæœ¬**ï¼ˆä¾‹å¦‚ï¼Œåªä¿ç•™è¿‡å» 7 å¤©å†…å†™å…¥çš„ç‰ˆæœ¬ï¼‰ã€‚

> éšæœºè¯»å†™çš„æ¥å£

**Bigtable API** æä¾›äº†åˆ›å»ºå’Œåˆ é™¤è¡¨åŠåˆ—æ—çš„åŠŸèƒ½ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å…è®¸æ›´æ”¹é›†ç¾¤ã€è¡¨å’Œåˆ—æ—çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚è®¿é—®æ§åˆ¶æƒé™ã€‚
ä¸‹é¢ä»£ç å—å±•ç¤ºäº†ä¸€æ®µå‘ `Bigtable` å†™å…¥æ•°æ®çš„ C++ ä»£ç ï¼Œä½¿ç”¨ `RowMutation` æŠ½è±¡æ¥æ‰§è¡Œä¸€ç³»åˆ—æ›´æ–°æ“ä½œã€‚ä¸ºä¿æŒä»£ç ç®€æ´ï¼Œä¾‹å­ä¸­çœç•¥äº†ä¸€äº›æ— å…³çš„æŠ€æœ¯ç»†èŠ‚ã€‚


```cpp
// æ‰“å¼€æŒ‡å®šè·¯å¾„çš„è¡¨ï¼Œå¦‚æœè¡¨ä¸å­˜åœ¨åˆ™åˆ›å»ºå®ƒ
Table* T = OpenOrDie("/bigtable/web/webtable");
// åˆ›å»ºä¸€ä¸ªè¡Œå¯¹è±¡ï¼Œç”¨äºå¯¹æŒ‡å®šè¡Œè¿›è¡Œä¿®æ”¹
RowMutation r1(T, "com.cnn.www");
// åœ¨æŒ‡å®šçš„åˆ—æ—å’Œåˆ—é”®ä¸‹è®¾ç½®ä¸€ä¸ªå€¼
// è¿™é‡Œè®¾ç½®åˆ—æ—ä¸º"anchor"ï¼Œåˆ—é”®ä¸º"www.c-span.org"ï¼Œå€¼ä¸º"CNN"
r1.Set("anchor:www.c-span.org", "CNN");
// åœ¨æŒ‡å®šçš„åˆ—æ—å’Œåˆ—é”®ä¸‹åˆ é™¤ä¸€ä¸ªå€¼
// è¿™é‡Œåˆ é™¤åˆ—æ—ä¸º"anchor"ï¼Œåˆ—é”®ä¸º"www.abc.com"çš„æ•°æ®
r1.Delete("anchor:www.abc.com");
// åˆ›å»ºä¸€ä¸ªæ“ä½œå¯¹è±¡ï¼Œç”¨äºå­˜å‚¨å¯¹è¡Œçš„ä¿®æ”¹æ“ä½œ
Operation op;
// åº”ç”¨ä¹‹å‰å®šä¹‰çš„ä¿®æ”¹æ“ä½œåˆ°è¡¨ä¸­
Apply(&op, &r1);
```
`Apply()` æ–¹æ³•å¯¹ `Webtable` æ‰§è¡Œä¸€æ¬¡åŸå­æ“ä½œï¼ŒåŒ…æ‹¬æ·»åŠ ä¸€ä¸ª `anchor` åˆ° `www.cnn.com`ï¼Œå¹¶åˆ é™¤å¦ä¸€ä¸ª `anchor`ã€‚

ä¸‹é¢ä»£ç å—å±•ç¤ºäº†å¦ä¸€ä¸ªä¾‹å­ï¼Œä½¿ç”¨ `Scanner` æŠ½è±¡éå†ä¸€è¡Œå†…çš„æ‰€æœ‰ anchorã€‚


```cpp
// åˆ›å»ºä¸€ä¸ªæ‰«æå™¨å¯¹è±¡ï¼Œç”¨äºæ‰«æè¡¨ä¸­çš„æ•°æ®
Scanner scanner(T);
// å£°æ˜ä¸€ä¸ªæ‰«ææµå¯¹è±¡ï¼Œç”¨äºè·å–ç‰¹å®šåˆ—æ—çš„æ•°æ®
ScanStream* stream;
// ä½¿ç”¨æ‰«æå™¨è·å–åä¸º"anchor"çš„åˆ—æ—æ•°æ®
stream = scanner.FetchColumnFamily("anchor");
// è®¾ç½®æ‰«ææµè¿”å›æ‰€æœ‰ç‰ˆæœ¬çš„æ•°æ®
stream->SetReturnAllVersions();
// ä½¿ç”¨æ‰«æå™¨æŸ¥æ‰¾ç‰¹å®šè¡Œçš„æ•°æ®
scanner.Lookup("com.cnn.www");
// éå†æ‰«ææµä¸­çš„æ•°æ®ï¼Œç›´åˆ°åˆ°è¾¾æµçš„æœ«å°¾
for (; !stream->Done(); stream->Next()) {
    // æ‰“å°è¡Œåã€åˆ—åã€å¾®ç§’çº§æ—¶é—´æˆ³å’Œæ•°æ®å€¼
    printf("%s %s %lld %s\n",
        scanner.RowName(),            // è¡Œå
        stream->ColumnName(),        // åˆ—å
        stream->MicroTimestamp(),    // å¾®ç§’çº§æ—¶é—´æˆ³
        stream->Value());             // æ•°æ®å€¼
}
```

å®¢æˆ·ç«¯å¯ä»¥åœ¨å¤šä¸ªåˆ—æ—ï¼ˆcolumn familyï¼‰ä¸Šè¿›è¡Œéå†ï¼Œå¹¶é€šè¿‡å¤šç§æœºåˆ¶é™åˆ¶ scan çš„ç»“æœè¡Œã€åˆ—å’Œæ—¶é—´æˆ³ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æŒ‡å®š scan åªäº§ç”Ÿåˆ—é”®åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ `anchor:*.cnn.com` çš„ anchorsï¼Œæˆ–æ—¶é—´æˆ³åœ¨æœ€è¿‘ 10 å¤©å†…çš„ anchorã€‚



### 2.3 å®ç°è¿‡ç¨‹

å°†æ•°æ®è¡¨æ ¹æ®å…¶ä¸»é”®çš„ä¸åŒï¼Œåˆ†æ•£å­˜å‚¨äºå¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œåœ¨åˆ†å¸ƒå¼æ•°æ®åº“é¢†åŸŸï¼Œè¿™ä¸€åšæ³•è¢«ç§°ä¸ºæ•°æ®åˆ†åŒºï¼ˆ`Partitioning`ï¼‰ã€‚åˆ†åŒºåçš„æ•°æ®ç‰‡æ®µï¼Œåœ¨ä¸åŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰ç€ä¸åŒçš„ç§°å‘¼ã€‚åœ¨`MySQL`ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä¹‹ä¸º`Shard`ï¼Œè€Œåœ¨`Bigtable`ä¸­ï¼Œåˆ™è¢«ç§°ä¸º`Tablet`ã€‚

MySQLé›†ç¾¤åœ¨åˆ†åŒºæ—¶ä¼šå¯¹æŸä¸ªå­—æ®µè¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œç„¶åæ ¹æ®ç»“æœå°†å…¶åˆ†é…åˆ°é¢„å…ˆè®¾å®šçš„Nä¸ªåˆ†ç‰‡ä¸­ã€‚è¿™ç§æ–¹æ³•æœ€å¤§çš„å¼Šç«¯åœ¨äºï¼Œåˆ†åŒºç­–ç•¥éœ€è¦åœ¨ä¸€å¼€å§‹å°±è¢«è®¾è®¡å¥½ï¼Œè€Œä¸æ˜¯èƒ½å¤Ÿéšç€æ•°æ®çš„å˜åŒ–è€Œè‡ªåŠ¨è°ƒæ•´ã€‚ç„¶è€Œè®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–ã€‚ä¸€æ—¦æˆ‘ä»¬çš„ä¸šåŠ¡å‘å±•ä¸æœ€åˆçš„è®¡åˆ’æœ‰æ‰€åå·®ï¼Œå°±å¯èƒ½éœ€è¦è¿›è¡Œæ•°æ®è¿ç§»ï¼Œæˆ–è€…é¢ä¸´åˆ†ç‰‡é—´è´Ÿè½½ä¸å‡è¡¡çš„é—®é¢˜ã€‚
 
åœ¨Bigtableä¸­ï¼Œé‡‡ç”¨äº†ä¸€ç§ä¸åŒçš„åˆ†åŒºç­–ç•¥ï¼Œå³åŠ¨æ€åŒºé—´åˆ†åŒºã€‚è¿™ç§æ–¹æ³•ä¸å†éœ€è¦åœ¨ä¸€å¼€å§‹å°±ç¡®å®šåˆ†åŒºçš„æ•°é‡å’Œå…·ä½“çš„åˆ†åŒºæ–¹å¼ï¼Œè€Œæ˜¯é€šè¿‡è‡ªåŠ¨â€œåˆ†è£‚â€ï¼ˆ`split`ï¼‰å’Œâ€œåˆå¹¶â€ï¼ˆ`merge`ï¼‰çš„æ–¹å¼æ¥åŠ¨æ€è°ƒæ•´åˆ†åŒºã€‚Bigtableä¼šæ ¹æ®**è¡Œé”®å¯¹æ•´ä¸ªæ•°æ®è¡¨è¿›è¡Œæ’åº**ï¼Œç„¶åæŒ‰ç…§è¿ç»­çš„è¡Œé”®åŒºé—´è¿›è¡Œåˆ†åŒºã€‚å¦‚æœæŸä¸ªåŒºé—´å†…çš„æ•°æ®é‡ä¸æ–­å¢åŠ ï¼Œå¯¼è‡´å­˜å‚¨ç©ºé—´éœ€æ±‚å¢å¤§ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†è¿™ä¸ªåŒºé—´çš„åˆ†åŒºåˆ†è£‚æˆä¸¤ä¸ªæ›´å°çš„åˆ†åŒºã€‚ç›¸åï¼Œå¦‚æœæŸä¸ªåŒºé—´çš„æ•°æ®è¢«å¤§é‡åˆ é™¤ï¼Œå ç”¨çš„ç©ºé—´å‡å°‘ï¼Œç³»ç»Ÿåˆ™ä¼šå°†è¿™ä¸ªåŒºé—´çš„åˆ†åŒºä¸ç›¸é‚»çš„åˆ†åŒºåˆå¹¶ï¼Œä»¥ä¼˜åŒ–å­˜å‚¨å’Œæ€§èƒ½ã€‚

è‹¥è¦å®ç°ä¸Šè¿°åŠŸèƒ½ï¼Œéœ€è¦ä¾èµ–äº`Bigtable`ç³»ç»Ÿæ¶æ„ä¸­çš„å…³é”®ç»„ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŒ…æ‹¬`GFS`ã€`Chubby`ã€`Tablet Server`å’Œ`Master`ç­‰ã€‚è¿™äº›ç»„ä»¶å…±åŒæ„æˆäº†`Bigtable`çš„æ ¸å¿ƒæ¶æ„ï¼Œç¡®ä¿äº†æ•°æ®çš„é«˜æ•ˆå­˜å‚¨ã€ç®¡ç†å’Œè®¿é—®ã€‚





![image](https://github.com/user-attachments/assets/3d841ec2-2223-41a7-9fa1-0f5af2b0d009)




- **GFSï¼ˆGoogle File Systemï¼‰**ï¼šæ‰¿æ‹…ç€å­˜å‚¨æ•°æ®çš„æ ¸å¿ƒèŒè´£ã€‚


`GFS` æ˜¯ `Google` å†…éƒ¨å¼€å‘çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œä¸“ä¸ºå¤„ç†å¤§è§„æ¨¡æ•°æ®è€Œè®¾è®¡ã€‚å®ƒé€šè¿‡å°†æ•°æ®åˆ†æˆå—å¹¶åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šå¤åˆ¶ï¼Œæä¾›äº†é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚åœ¨ `Bigtable` ä¸­ï¼Œ`GFS` è´Ÿè´£å­˜å‚¨æ‰€æœ‰çš„æ•°æ®æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶ã€‚æ¯ä¸ªæ“ä½œéƒ½ä¼šè¢«è®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œç¡®ä¿å³ä½¿åœ¨æœåŠ¡å™¨æ•…éšœæ—¶æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚

`GFS` çš„è®¾è®¡ä½¿å…¶èƒ½å¤Ÿå¤„ç†å¤§è§„æ¨¡çš„æ•°æ®æµå’Œæ‰¹é‡å¤„ç†ä»»åŠ¡ã€‚é€šè¿‡ä½¿ç”¨æ ‡å‡†çš„ç¡¬ä»¶å’Œè½¯ä»¶ï¼ŒGFS æ˜¾è‘—é™ä½äº†è¿è¥æˆæœ¬ï¼ŒåŒæ—¶æé«˜äº†ç³»ç»Ÿçš„æ•´ä½“æ•ˆç‡ã€‚ï¼ˆæ¥è‡ªï¼š[002.ç²¾è¯»ã€ŠThe Google File Systemã€‹| å¤§æ•°æ®çš„ä¸‰é©¾é©¬è½¦ä¹‹ä¸€ï¼šGFS](https://blog.csdn.net/jankin6/article/details/141526604)ï¼‰

> - **æ•°æ®å­˜å‚¨**ï¼šGFSè´Ÿè´£å­˜å‚¨Bigtableä¸­çš„å®é™…æ•°æ®ã€‚
> - **æ•°æ®æŒä¹…åŒ–**ï¼šç¡®ä¿æ•°æ®åœ¨ç³»ç»Ÿæ•…éšœæ—¶ä¸ä¼šä¸¢å¤±ï¼Œé€šè¿‡åœ¨å¤šä¸ªä½ç½®å­˜å‚¨æ•°æ®å‰¯æœ¬ã€‚
> - **é«˜å¯ç”¨æ€§**ï¼šæä¾›é«˜å¯ç”¨çš„æ•°æ®è®¿é—®ï¼Œå³ä½¿éƒ¨åˆ†ç¡¬ä»¶æˆ–æœåŠ¡å™¨å‡ºç°é—®é¢˜ï¼Œæ•°æ®ä¾ç„¶å¯ä»¥è¢«è®¿é—®ã€‚
> - **å¤§è§„æ¨¡æ•°æ®å¤„ç†**ï¼šæ”¯æŒBigtableå¤„ç†å’Œå­˜å‚¨PBçº§åˆ«çš„å¤§æ•°æ®ã€‚
> - **æ•°æ®å—ç®¡ç†**ï¼šå°†æ•°æ®åˆ†å‰²æˆå—ï¼Œä¾¿äºç®¡ç†å’Œåœ¨å¤šä¸ªæœåŠ¡å™¨é—´å¤åˆ¶ï¼Œä»¥æé«˜æ•ˆç‡å’Œå¯é æ€§ã€‚


- **Chubby**ï¼šæ‰®æ¼”ç€åˆ†å¸ƒå¼é”å’Œç›®å½•æœåŠ¡çš„è§’è‰²ï¼Œç¡®ä¿ç³»ç»Ÿçš„åè°ƒå’Œä¸€è‡´æ€§ã€‚


>A Chubby service consists of five active replicas, one of which is elected to be the master and actively serve requests.Chubby uses the Paxos algorithm to keep its replicas consistent in the face of failure.Chubby provides a namespace that consists of directories and small files.Each directory or file can be used as a lock, and reads and writes to a file are atomic.

`Chubby`æœåŠ¡ç”±äº”ä¸ªå‰¯æœ¬æ„æˆï¼Œå…¶ä¸­ä¸€ä¸ªå‰¯æœ¬æ‹…ä»»masterè§’è‰²ï¼Œè´Ÿè´£å¤„ç†æ‰€æœ‰è¯·æ±‚ã€‚`Chubby`é‡‡ç”¨`Paxos`ç®—æ³•æ¥ç¡®ä¿å‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚å®ƒæä¾›çš„å‘½åç©ºé—´ç”±ç›®å½•å’Œå°å‹æ–‡ä»¶ç»„æˆï¼Œè¿™äº›å¯ä»¥è¢«ç”¨ä½œé”ï¼Œå¹¶ä¸”æ”¯æŒåŸå­æ€§çš„è¯»å†™æ“ä½œã€‚å®¢æˆ·ç«¯é€šè¿‡å»ºç«‹ä¼šè¯ä¸`Chubby`æœåŠ¡è¿›è¡Œäº¤äº’ï¼Œå¦‚æœä¼šè¯è¶…æ—¶ï¼Œåˆ™ä¼šå¯¼è‡´å¤±å»é”å’Œå¥æŸ„ã€‚`Bigtable`åˆ©ç”¨`Chubby`æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªæ´»è·ƒçš„`master`ï¼Œå­˜å‚¨æ•°æ®çš„å¯åŠ¨ä½ç½®ï¼Œå‘ç°tabletæœåŠ¡å™¨ï¼Œç»´æŠ¤æ¶æ„ä¿¡æ¯ä»¥åŠå­˜å‚¨è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆ`ACLs`ï¼‰ã€‚


> The average percentage of Bigtable server hours during which some data stored in Bigtable was not available due to Chubby unavailability (caused by either Chubby outages or network issues) was **0.0047%**. The percentage for the single cluster that was most affected by Chubby unavailability was **0.0326%**.

é•¿æ—¶é—´çš„ `Chubby` ä¸å¯ç”¨ä¼šå¯¼è‡´ `Bigtable` ä¸å¯ç”¨ï¼Œä½†è¿™ç§æƒ…å†µå¾ˆå°‘è§ï¼Œå½±å“æå°ã€‚



> - **ç»´æŠ¤å•ä¸€Masterå®ä¾‹**ï¼šç¡®ä¿ç³»ç»Ÿä¸­ä»…å­˜åœ¨ä¸€ä¸ªMasterï¼Œä»¥ä¿æŒé›†ç¾¤çš„ä¸€è‡´æ€§å’Œç¨³å®šæ€§ã€‚
> - **ç®¡ç†Bigtableæ•°æ®çš„å¼•å¯¼ä½ç½®ï¼ˆBootstrap Locationï¼‰**ï¼šè´Ÿè´£å­˜å‚¨Bigtableæ•°æ®çš„å¯åŠ¨ä½ç½®ä¿¡æ¯ï¼Œä»¥ä¾¿å¿«é€Ÿå¼•å¯¼å’Œæ¢å¤ã€‚
> - **ç›‘æ§Tablet Serverçš„ç”Ÿå‘½å‘¨æœŸ**ï¼šå‘ç°æ–°åŠ å…¥çš„Tablet Serversï¼Œå¹¶åœ¨å®ƒä»¬åœæ­¢æœåŠ¡åå®Œæˆå¿…è¦çš„æ¸…ç†å·¥ä½œã€‚
> - **ç»´æŠ¤Bigtableçš„Schemaä¿¡æ¯**ï¼šè´Ÿè´£å­˜å‚¨å’Œç®¡ç†Bigtableçš„Schemaä¿¡æ¯ï¼Œç¡®ä¿æ•°æ®ç»“æ„çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚
> - **ç®¡ç†ACLï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰**ï¼šå­˜å‚¨Bigtableçš„è®¿é—®æƒé™ï¼ˆACLï¼‰ï¼Œæ§åˆ¶ç”¨æˆ·å¯¹æ•°æ®çš„è®¿é—®ï¼Œä¿éšœæ•°æ®å®‰å…¨ã€‚



- **Tablet Server**ï¼šç›´æ¥æä¾›åœ¨çº¿æœåŠ¡ï¼Œå¤„ç†å®é™…çš„æ•°æ®æ“ä½œã€‚

>  - **å¤„ç†æ•°æ®è¯·æ±‚**ï¼šå“åº”å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ã€‚
>   - **å­˜å‚¨æ•°æ®**ï¼šä¿å­˜å’Œç®¡ç†åˆ†é…ç»™å®ƒçš„æ•°æ®ç‰‡æ®µï¼ˆTabletsï¼‰ã€‚
>   - **æ•°æ®åˆ†è£‚ä¸åˆå¹¶**ï¼šæ ¹æ®æ•°æ®é‡è‡ªåŠ¨åˆ†è£‚å¤§çš„Tabletæˆ–åˆå¹¶å°çš„Tabletã€‚
>   - **æ•°æ®å¤åˆ¶**ï¼šç¡®ä¿æ•°æ®åœ¨å¤šä¸ªæœåŠ¡å™¨é—´å¤åˆ¶ï¼Œä»¥æé«˜æ•°æ®çš„å¯é æ€§ã€‚
>   - **æŸ¥è¯¢æ‰§è¡Œ**ï¼šæ‰§è¡Œæ•°æ®æŸ¥è¯¢å¹¶è¿”å›ç»“æœã€‚
>   - **æ•…éšœæ¢å¤**ï¼šåœ¨å‘ç”Ÿæ•…éšœæ—¶å¿«é€Ÿæ¢å¤æœåŠ¡ã€‚
>   - **è´Ÿè½½å‡è¡¡**ï¼šä¸Master Serveråˆä½œï¼ŒåŠ¨æ€è°ƒæ•´æ•°æ®åˆ†å¸ƒä»¥å¹³è¡¡è´Ÿè½½ã€‚



 - **Master**ï¼šè´Ÿè´£è°ƒåº¦Tabletçš„åˆ†é…å’Œè´Ÿè½½å‡è¡¡ï¼Œä»¥ä¼˜åŒ–æ•´ä½“æ€§èƒ½ã€‚

> - **åˆ†é…Tabletsè‡³Tablet Server**ï¼šè´Ÿè´£å°†TabletsæŒ‡æ´¾ç»™ç›¸åº”çš„Tablet Serverã€‚
> - **ç›‘æ§Tablet Serverçš„åŠ¨æ€**ï¼šæ£€æµ‹å¹¶å¤„ç†Tablet Serverçš„åŠ å…¥ä¸é€€å‡ºã€‚
> - **è´Ÿè½½å‡è¡¡**ï¼šå¹³è¡¡å„ä¸ªTablet Serverçš„è´Ÿè½½ï¼Œç¡®ä¿èµ„æºçš„é«˜æ•ˆåˆ©ç”¨ã€‚
> - **æ•°æ®åƒåœ¾å›æ”¶**ï¼šåœ¨GFSä¸Šæ‰§è¡Œæ•°æ®çš„åƒåœ¾å›æ”¶ï¼ˆGarbage Collection, GCï¼‰ï¼Œä»¥ç»´æŠ¤æ•°æ®çš„æ•´æ´å’Œå­˜å‚¨ç©ºé—´çš„æœ‰æ•ˆåˆ©ç”¨ã€‚
> - **ç®¡ç†Schemaå˜æ›´**ï¼šè´Ÿè´£è¡¨ï¼ˆTableï¼‰å’Œåˆ—æ—ï¼ˆColumn Familyï¼‰çš„Schemaå˜æ›´ç®¡ç†ï¼ŒåŒ…æ‹¬åˆ›å»ºå’Œåˆ é™¤è¡¨ä»¥åŠåˆ—æ—ã€‚



![image](https://github.com/user-attachments/assets/099ad423-fab7-46d0-a7f2-607d1a24444f)


> The first level is a file stored in Chubby that contains the location of the root tablet.
> The root tablet contains the location of all tablets in a special METADATA table.
> The root tablet is just the first tablet in the METADATA table, but is treated speciallyâ€”it is never splitâ€”to ensure that the tablet location hierarchy has no more than three levels.



ä½¿ç”¨ä¸‰çº§å±‚æ¬¡ç»“æ„å­˜å‚¨tabletçš„ä½ç½®ä¿¡æ¯ï¼Œç±»ä¼¼äºB+æ ‘ã€‚è¿™åŒ…æ‹¬å­˜å‚¨åœ¨`Chubby`ä¸­çš„æ ¹tabletä½ç½®ã€`METADATA`è¡¨ä¸­çš„tabletä½ç½®ï¼Œä»¥åŠç”¨æˆ·tabletçš„ä½ç½®ã€‚

- **ç¬¬ä¸€å±‚**ï¼šä¸€ä¸ªå­˜å‚¨åœ¨Chubbyä¸­çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†æ ¹tabletï¼ˆ`root tablet`ï¼‰çš„ä½ç½®ä¿¡æ¯ã€‚è¿™ä¸ªæ–‡ä»¶ä½œä¸ºæ•´ä¸ªç³»ç»Ÿçš„å…¥å£ç‚¹ï¼Œç”¨äºå¿«é€Ÿå®šä½æ ¹tabletã€‚

- **ç¬¬äºŒå±‚**ï¼šæ ¹tabletåœ¨ä¸€ä¸ªç‰¹æ®Šçš„`METADATA`è¡¨ä¸­ï¼ŒåŒ…å«äº†æ‰€æœ‰å…¶ä»–tabletçš„ä½ç½®ä¿¡æ¯ã€‚æ ¹tabletæ˜¯METADATAè¡¨ä¸­çš„ç¬¬ä¸€ä¸ªtabletï¼Œä½†å®ƒè¢«ç‰¹æ®Šå¯¹å¾…ï¼Œå› ä¸ºå®ƒæ°¸è¿œä¸ä¼šè¢«åˆ†è£‚ï¼ˆsplitï¼‰ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿tabletä½ç½®å±‚æ¬¡ç»“æ„ä¸è¶…è¿‡ä¸‰å±‚ã€‚

- **ç¬¬ä¸‰å±‚**ï¼šæ¯ä¸ª`METADATA` tabletï¼ˆé™¤äº†æ ¹tabletåŒ…å«ä¸€ç»„ç”¨æˆ·tabletçš„ä½ç½®ä¿¡æ¯ã€‚è¿™äº›`METADATA` tabletsè´Ÿè´£å­˜å‚¨ç”¨æˆ·æ•°æ®è¡¨ä¸­tabletçš„ä½ç½®ä¿¡æ¯ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿæ ¹æ®è¿™äº›ä¿¡æ¯å®šä½åˆ°å…·ä½“çš„æ•°æ®ã€‚




> If the clientâ€™s cache is empty, the location algorithm requires three network round-trips, including one read from Chubby.If the clientâ€™s cache is stale, the location algorithm could take up to six round-trips.


å®¢æˆ·ç«¯åº“é€šè¿‡ç¼“å­˜tabletä½ç½®ä¿¡æ¯æ¥æå‡è®¿é—®æ•ˆç‡ã€‚å½“ç¼“å­˜ä¿¡æ¯å¤±æ•ˆæ—¶ï¼Œå®ƒä¼šé€’å½’æŸ¥è¯¢tabletä½ç½®å±‚çº§ã€‚åˆæ¬¡æŸ¥æ‰¾é€šå¸¸éœ€è¦ä¸‰æ¬¡ç½‘ç»œå¾€è¿”ï¼Œè€Œç¼“å­˜ä¿¡æ¯è¿‡æœŸæ—¶å¯èƒ½éœ€è¦å¤šè¾¾å…­æ¬¡ç½‘ç»œå¾€è¿”â€”â€”è¿™ç§æƒ…å†µé€šå¸¸å‘ç”Ÿåœ¨ç¼“å­˜æœªå‘½ä¸­æ—¶ï¼Œä¸”å‰ææ˜¯METADATA tabletsçš„ç§»åŠ¨ä¸æ˜¯éå¸¸é¢‘ç¹ã€‚ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œå®¢æˆ·ç«¯åº“åœ¨è¯»å–METADATAè¡¨æ—¶ä¼šé¢„å…ˆè·å–å¤šä¸ªtabletçš„ä½ç½®ä¿¡æ¯ã€‚è¿™æ ·å¯ä»¥å‡å°‘æœªæ¥çš„ç½‘ç»œå¾€è¿”æ¬¡æ•°ï¼Œæé«˜æ•´ä½“çš„æ•°æ®è®¿é—®æ•ˆç‡ã€‚


- **å¦‚æœå®¢æˆ·ç«¯ç¼“å­˜ä¸ºç©º**ï¼šå½“å®¢æˆ·ç«¯çš„ç¼“å­˜ä¸­æ²¡æœ‰å­˜å‚¨ä»»ä½•å…³äºtabletä½ç½®çš„ä¿¡æ¯æ—¶ï¼Œå®¢æˆ·ç«¯éœ€è¦æ‰§è¡Œä¸€ä¸ªå®šä½ç®—æ³•æ¥ç¡®å®šæ•°æ®çš„ä½ç½®ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦ä¸‰æ¬¡ç½‘ç»œå¾€è¿”ï¼ˆround-tripsï¼‰ï¼š
  1. ç¬¬ä¸€æ¬¡ç½‘ç»œå¾€è¿”å¯èƒ½æ˜¯å®¢æˆ·ç«¯å‘Chubbyè¯·æ±‚æ ¹tabletçš„ä½ç½®ã€‚
  2. ç¬¬äºŒæ¬¡ç½‘ç»œå¾€è¿”æ˜¯å®¢æˆ·ç«¯æ ¹æ®Chubbyæä¾›çš„ä¿¡æ¯å»è¯·æ±‚METADATAè¡¨ä¸­çš„ç›¸åº”tabletä½ç½®ã€‚
  3. ç¬¬ä¸‰æ¬¡ç½‘ç»œå¾€è¿”æ˜¯å®¢æˆ·ç«¯æ ¹æ®METADATAè¡¨ä¸­çš„ä½ç½®ä¿¡æ¯å»è¯·æ±‚å®é™…çš„æ•°æ®ã€‚

- **å¦‚æœå®¢æˆ·ç«¯ç¼“å­˜è¿‡æ—¶**ï¼šå½“å®¢æˆ·ç«¯ç¼“å­˜çš„ä¿¡æ¯å·²ç»ä¸å†æœ‰æ•ˆï¼ˆå³ç¼“å­˜è¿‡æ—¶ï¼‰æ—¶ï¼Œå®¢æˆ·ç«¯éœ€è¦æ›´æ–°å…¶ç¼“å­˜ä»¥è·å–æœ€æ–°çš„tabletä½ç½®ä¿¡æ¯ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦å¤šè¾¾å…­æ¬¡ç½‘ç»œå¾€è¿”ï¼š
  1. ç¬¬ä¸€æ¬¡ç½‘ç»œå¾€è¿”å¯èƒ½æ˜¯å®¢æˆ·ç«¯å°è¯•ä½¿ç”¨ç¼“å­˜ä¸­çš„ä¿¡æ¯å»è¯·æ±‚æ•°æ®ã€‚
  2. å½“å‘ç°ç¼“å­˜ä¿¡æ¯è¿‡æ—¶åï¼Œå®¢æˆ·ç«¯éœ€è¦é‡æ–°æŸ¥è¯¢Chubbyä»¥è·å–æœ€æ–°çš„æ ¹tabletä½ç½®ã€‚
  3. ç¬¬äºŒæ¬¡ç½‘ç»œå¾€è¿”æ˜¯å®¢æˆ·ç«¯æ ¹æ®Chubbyæä¾›çš„æœ€æ–°ä¿¡æ¯å»è¯·æ±‚METADATAè¡¨ä¸­çš„ç›¸åº”tabletä½ç½®ã€‚
  4. ç¬¬ä¸‰æ¬¡ç½‘ç»œå¾€è¿”æ˜¯å®¢æˆ·ç«¯æ ¹æ®METADATAè¡¨ä¸­çš„ä½ç½®ä¿¡æ¯å»è¯·æ±‚å®é™…çš„æ•°æ®ã€‚
  5. å¦‚æœåœ¨è¯·æ±‚æ•°æ®çš„è¿‡ç¨‹ä¸­å‘ç°METADATAè¡¨ä¸­çš„ä¿¡æ¯ä¹Ÿè¿‡æ—¶äº†ï¼Œå®¢æˆ·ç«¯å¯èƒ½éœ€è¦é¢å¤–çš„ç½‘ç»œå¾€è¿”æ¥æ›´æ–°METADATAè¡¨ä¸­çš„ä¿¡æ¯ã€‚
  6. æœ€åï¼Œå®¢æˆ·ç«¯å†æ¬¡æ ¹æ®æ›´æ–°åçš„METADATAè¡¨ä¿¡æ¯å»è¯·æ±‚å®é™…çš„æ•°æ®ã€‚


è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥è¯´æ˜Bigtableçš„è¯»å†™æµç¨‹ï¼š

>  è¯»æµç¨‹å®ä¾‹ï¼š

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåœ¨çº¿ä¹¦åº—ï¼Œæƒ³è¦æŸ¥è¯¢æŸä¸ªç‰¹å®šä¹¦ç±çš„ä¿¡æ¯ã€‚

1. **å®¢æˆ·ç«¯è¯·æ±‚**ï¼š
   - ç”¨æˆ·åœ¨ä¹¦åº—ç½‘ç«™ä¸Šæœç´¢ã€Šæœˆäº®ä¸å…­ä¾¿å£«ã€‹è¿™æœ¬ä¹¦çš„è¯¦ç»†ä¿¡æ¯ã€‚

2. **å®¢æˆ·ç«¯å®šä½æ•°æ®**ï¼š
   - å®¢æˆ·ç«¯ï¼ˆç½‘ç«™æœåŠ¡å™¨ï¼‰çš„ç¼“å­˜ä¸­æ²¡æœ‰è¿™æœ¬ä¹¦çš„åº“å­˜ä¿¡æ¯ï¼Œå› æ­¤å®ƒéœ€è¦æŸ¥è¯¢Bigtableã€‚
   - å®¢æˆ·ç«¯é¦–å…ˆæŸ¥è¯¢Chubbyä»¥è·å–æ ¹tabletçš„ä½ç½®ä¿¡æ¯ã€‚

3. **è·å–METADATAä¿¡æ¯**ï¼š
   - å®¢æˆ·ç«¯ä½¿ç”¨æ ¹tabletæ‰¾åˆ°METADATAè¡¨ä¸­è´Ÿè´£ä¹¦ç±ä¿¡æ¯çš„tabletä½ç½®ã€‚
   - å®¢æˆ·ç«¯å¯èƒ½éœ€è¦æŸ¥è¯¢å¤šä¸ªMETADATA tabletsï¼Œç›´åˆ°æ‰¾åˆ°æ­£ç¡®çš„tabletä½ç½®ã€‚

4. **è¯·æ±‚Tablet Server**ï¼š
   - å®¢æˆ·ç«¯å‘æ‰˜ç®¡è¯¥tabletçš„Tablet Serverå‘é€è¯»å–è¯·æ±‚ã€‚

5. **Tablet Serverå¤„ç†è¯·æ±‚**ï¼š
   - Tablet Serveråœ¨æœ¬åœ°æŸ¥æ‰¾ã€Šæœˆäº®ä¸å…­ä¾¿å£«ã€‹çš„æ•°æ®ï¼Œå¦‚æœæ•°æ®ä¸åœ¨å†…å­˜ä¸­ï¼Œå®ƒä¼šä»GFSä¸­è¯»å–ã€‚

6. **è¿”å›æ•°æ®ç»™å®¢æˆ·ç«¯**ï¼š
   - Tablet Serverå°†ä¹¦ç±çš„è¯¦ç»†ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯éšåå°†è¿™äº›ä¿¡æ¯å±•ç¤ºç»™ç”¨æˆ·ã€‚

 > å†™æµç¨‹å®ä¾‹ï¼š

ç°åœ¨ï¼Œå‡è®¾ä¹¦åº—æƒ³è¦æ›´æ–°ã€Šæœˆäº®ä¸å…­ä¾¿å£«ã€‹çš„åº“å­˜æ•°é‡ã€‚

1. **å®¢æˆ·ç«¯è¯·æ±‚**ï¼š
   - ä¹¦åº—çš„åº“å­˜ç®¡ç†ç³»ç»Ÿå‡å°‘äº†ã€Šæœˆäº®ä¸å…­ä¾¿å£«ã€‹çš„åº“å­˜æ•°é‡ã€‚

2. **å†™å…¥æ•°æ®**ï¼š
   - å®¢æˆ·ç«¯ï¼ˆåº“å­˜ç®¡ç†ç³»ç»Ÿï¼‰å°†æ›´æ–°è¯·æ±‚å‘é€ç»™æ‰˜ç®¡ç›®æ ‡tabletçš„Tablet Serverã€‚

3. **Tablet Serverå¤„ç†å†™å…¥**ï¼š
   - Tablet Serveræ¥æ”¶åˆ°æ›´æ–°è¯·æ±‚ï¼Œå°†æ–°çš„åº“å­˜æ•°é‡å†™å…¥å…¶ç®¡ç†çš„Tabletã€‚
   - Tablet Serverè¿˜ä¼šå°†è¿™ä¸ªæ›´æ–°å¤åˆ¶åˆ°å…¶ä»–å‰¯æœ¬ï¼Œä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚

4. **æ•°æ®åˆ†è£‚å’Œåˆå¹¶**ï¼š
   - å¦‚æœè¿™ä¸ªtabletå› ä¸ºé¢‘ç¹çš„å†™å…¥æ“ä½œå˜å¾—å¤ªå¤§ï¼ŒTablet Serverä¼šå°†å…¶åˆ†è£‚æˆä¸¤ä¸ªæ–°çš„tabletsã€‚
   - å¦‚æœè¿™ä¸ªtabletå› ä¸ºæ•°æ®åˆ é™¤å˜å¾—å¤ªå°ï¼Œå¯èƒ½ä¼šä¸ç›¸é‚»çš„tabletåˆå¹¶ã€‚

5. **æ›´æ–°METADATA**ï¼š
   - å†™å…¥æ“ä½œå®Œæˆåï¼Œç›¸å…³çš„METADATAä¿¡æ¯ä¼šè¢«æ›´æ–°ï¼Œä»¥åæ˜ åº“å­˜æ•°æ®çš„æ–°ä½ç½®ã€‚

6. **è¿”å›å†™å…¥ç»“æœç»™å®¢æˆ·ç«¯**ï¼š
   - Tablet Serverç¡®è®¤å†™å…¥æ“ä½œæˆåŠŸï¼Œå¹¶è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯éšåæ›´æ–°åº“å­˜ç®¡ç†ç³»ç»Ÿä¸­çš„çŠ¶æ€ã€‚





### 2.4 åº•å±‚ç»“æ„



`Bigtable`å†…éƒ¨é‡‡ç”¨`Google`çš„`SSTable`æ ¼å¼æ¥å­˜å‚¨æ•°æ®ã€‚`SSTable`æ˜¯ä¸€ç§æŒä¹…åŒ–ã€æœ‰åºä¸”ä¸å¯å˜çš„é”®å€¼å­˜å‚¨ç»“æ„ï¼Œå…¶ä¸­é”®å’Œå€¼å‡å¯ä»¥æ˜¯ä»»æ„çš„å­—èŠ‚å­—ç¬¦ä¸²åºåˆ—ã€‚å®ƒæ”¯æŒé€šè¿‡é”®è¿›è¡ŒæŸ¥è¯¢ä»¥åŠå¯¹æŒ‡å®šé”®èŒƒå›´è¿›è¡Œéå†ã€‚

> An SSTable provides a persistent, ordered immutable map from keys to values, where both keys and values are arbitrary byte strings.A lookup can be performed with a single disk seek: we first find the appropriate block by performing a binary search in the in-memory index, and then reading the appropriate block from disk.


`SSTable`ç”±å¤šä¸ªæ•°æ®å—æ„æˆï¼Œæ¯ä¸ªå—çš„æ ‡å‡†å¤§å°ä¸º`64KB`ï¼Œä½†è¿™ä¸ªå¤§å°æ˜¯å¯é…ç½®çš„ã€‚è¿™äº›æ•°æ®å—é€šè¿‡ä½äº`SSTable`æ–‡ä»¶æœ«å°¾çš„å—ç´¢å¼•æ¥å®šä½ï¼Œå½“`SSTable`è¢«æ‰“å¼€æ—¶ï¼Œè¿™ä¸ªç´¢å¼•ä¼šè¢«åŠ è½½è¿›å†…å­˜ã€‚æŸ¥è¯¢æ“ä½œä»…éœ€ä¸€æ¬¡ç£ç›˜æŸ¥æ‰¾ï¼šé¦–å…ˆåœ¨å†…å­˜ä¸­çš„ç´¢å¼•é‡Œé€šè¿‡äºŒåˆ†æŸ¥æ‰¾ç¡®å®šæ‰€éœ€æ•°æ®å—çš„ä½ç½®ï¼Œç„¶åç›´æ¥ä»ç£ç›˜è¯»å–è¯¥æ•°æ®å—ã€‚æ­¤å¤–ï¼Œ`SSTable`æ–‡ä»¶å¯ä»¥è¢«å®Œæ•´åœ°æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œè¿™æ ·å¯ä»¥å®ç°æ— éœ€ç£ç›˜**I/O**çš„å¿«é€Ÿæ•°æ®æŸ¥æ‰¾å’ŒèŒƒå›´æ‰«æï¼Œä»è€Œå¤§å¹…æå‡æ€§èƒ½ã€‚


![image](https://github.com/user-attachments/assets/20289660-4e6b-4f9d-88d3-40ec6eb4ae87)


Bigtableå®é™…å†™å…¥æ•°æ®çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š

1.  å½“ä¸€ä¸ªå†™è¯·æ±‚åˆ°æ¥æ—¶ï¼Œ`Tablet Server` é¦–å…ˆæ‰§è¡ŒåŸºç¡€çš„æ•°æ®éªŒè¯ï¼ŒåŒ…æ‹¬æ£€æŸ¥æ•°æ®æ ¼å¼æ˜¯å¦åˆæ³•ï¼Œä»¥åŠç¡®è®¤å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯æ˜¯å¦æœ‰æƒé™è¿›è¡Œå¯¹åº”çš„æ“ä½œã€‚è¿™ä¸ªæƒé™è®¾ç½®ï¼Œæ˜¯ `Tablet Server` ä» **Chubby** ä¸­è·å–åˆ°ï¼Œå¹¶ä¸”ç¼“å­˜åœ¨æœ¬åœ°çš„ã€‚

2. å¦‚æœå†™å…¥çš„è¯·æ±‚æ˜¯åˆæ³•çš„ï¼Œå¯¹åº”çš„æ•°æ®å†™å…¥è¯·æ±‚ä¼šä»¥è¿½åŠ å†™çš„å½¢å¼ï¼Œå†™å…¥åˆ° **GFS** ä¸Šçš„æäº¤æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªå†™å…¥å¯¹äº **GFS** ä¸Šçš„ç¡¬ç›˜æ¥è¯´æ˜¯ä¸€ä¸ªé¡ºåºå†™ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬ä¾¿è®¤ä¸ºæ•´ä¸ªæ•°æ®å†™å…¥å°±å·²ç»æˆåŠŸäº†ã€‚

3. æäº¤æ—¥å¿—å†™å…¥æˆåŠŸåï¼ŒTablet Server ä¼šå†æŠŠæ•°æ®å†™å…¥åˆ°ä¸€å¼ å†…å­˜è¡¨ä¸­ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ **MemTable**ã€‚éšç€å†™å…¥çš„æ•°æ®é‡å¢åŠ ï¼Œå½“è¾¾åˆ°é¢„è®¾çš„é˜ˆå€¼æ—¶ï¼ŒTablet Server ä¼šæŠŠå½“å‰å†…å­˜é‡Œçš„æ•´ä¸ª **MemTable** å†»ç»“ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„ **MemTable**ã€‚

4. è¢«å†»ç»“çš„è¿™ä¸ª **MemTable**ï¼Œä¸€èˆ¬è¢«å«åš **Immutable MemTable**ï¼Œå®ƒä¼šè¢«è½¬åŒ–æˆä¸€ä¸ªå«åš **SSTable** çš„æ–‡ä»¶ï¼Œå†™å…¥åˆ° **GFS** ä¸Šï¼Œç„¶åå†ä»å†…å­˜é‡Œé¢é‡Šæ”¾æ‰ã€‚è¿™ä¸ªå†™å…¥è¿‡ç¨‹ï¼Œæ˜¯å®Œæ•´å†™ä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œæ‰€ä»¥è‡ªç„¶ä¹Ÿæ˜¯é¡ºåºå†™ã€‚å¦‚æœåœ¨ä¸Šè¿°ç¬¬2æ­¥ï¼Œä¹Ÿå°±æ˜¯æäº¤æ—¥å¿—å†™å…¥å®Œæˆä¹‹åï¼ŒTablet Server å› ä¸ºå„ç§åŸå› å´©æºƒï¼Œé‚£ä¹ˆåœ¨é‡å¯æ—¶ï¼Œå¯ä»¥é€šè¿‡é‡æ–°æ’­æ”¾æäº¤æ—¥å¿—æ¥æ¢å¤ **MemTable** ä¸­çš„æ•°æ®ã€‚




å®é™…ä¸Šï¼ŒBigtableåœ¨å¤„ç†æ•°æ®æ—¶ï¼Œå¹¶ä¸ä¼šç›´æ¥ä¿®æ”¹å·²å†™å…¥çš„æ•°æ®ã€‚æ— è®ºæ˜¯æ’å…¥è¿˜æ˜¯æ›´æ–°æ“ä½œï¼Œæˆ‘ä»¬éƒ½æ˜¯åœ¨è¿½åŠ æ–°ç‰ˆæœ¬çš„æ•°æ®ã€‚åˆ é™¤æ“ä½œä¹Ÿåªæ˜¯å†™å…¥ä¸€ä¸ª**å¢“ç¢‘æ ‡è®°**ï¼Œè¿™æœ¬è´¨ä¸Šä¹Ÿæ˜¯æ·»åŠ äº†ä¸€ä¸ªç‰¹æ®Šçš„æ–°ç‰ˆæœ¬æ•°æ®ã€‚æ•°æ®çš„â€œä¿®æ”¹â€å’Œâ€œåˆ é™¤â€ä¸»è¦åœ¨ä¸¤ä¸ªé˜¶æ®µå‘ç”Ÿï¼š

1. **Major Compaction æœºåˆ¶**ï¼šæ ¹æ®å‰é¢æè¿°çš„æ•°æ®å†™å…¥æœºåˆ¶ï¼Œéšç€æ•°æ®ä¸æ–­å†™å…¥ï¼Œä¼šäº§ç”Ÿè¶Šæ¥è¶Šå¤šçš„SSTableæ–‡ä»¶ã€‚ä¸ºäº†å‡å°‘è¿™äº›æ–‡ä»¶å ç”¨çš„GFSç¡¬ç›˜ç©ºé—´ï¼Œåå°è¿›ç¨‹ä¼šä¸æ–­å¯¹è¿™äº›SSTableæ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºMajor Compactionï¼Œæ„ä¸ºâ€œå‹å®â€æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰10ä¸ªæ–‡ä»¶ä¸­éƒ½åŒ…å«äº†`com.cnn.www`è¿™ä¸ªè¡Œé”®çš„å¤šä¸ªç‰ˆæœ¬æ•°æ®ï¼Œåˆå¹¶åï¼Œæ ¹æ®è®¾å®šçš„æ•°æ®ä¿ç•™ç­–ç•¥ï¼Œæˆ‘ä»¬å¯èƒ½åªä¿ç•™æ—¶é—´æˆ³æœ€æ–°çš„ä¸‰ä¸ªç‰ˆæœ¬ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ—§ç‰ˆæœ¬çš„æ•°æ®åœ¨ç‰©ç†ä¸Šè¢«çœŸæ­£åˆ é™¤ã€‚

2. **è¯»å–æ•°æ®æ—¶çš„åˆå¹¶è§†å›¾**ï¼šåœ¨è¯»å–æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯ä»`MemTable`å’Œå¤šä¸ªSSTableæ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå½¢æˆä¸€ä¸ªåˆå¹¶è§†å›¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä»`MemTable`å’Œæ‰€æœ‰ç›¸å…³çš„`SSTable`ä¸­è·å–å¯¹åº”è¡Œé”®çš„æ•°æ®åï¼Œåœ¨å†…å­˜ä¸­åˆå¹¶è¿™äº›æ•°æ®ï¼Œå¹¶æ ¹æ®æ—¶é—´æˆ³æˆ–å¢“ç¢‘æ ‡è®°å¯¹æ•°æ®è¿›è¡Œâ€œä¿®æ”¹â€å’Œâ€œåˆ é™¤â€ï¼Œç„¶åå°†å¤„ç†åçš„æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚


ç»¼ä¸Šï¼š Bigtableå°†ç¡¬ç›˜çš„éšæœºå†™æ“ä½œè½¬åŒ–ä¸ºé¡ºåºå†™æ“ä½œã€‚è¿™æ˜¯é€šè¿‡æäº¤æ—¥å¿—ï¼ˆ`Commit Log`ï¼‰ä»¥åŠå°†å†…å­˜è¡¨ï¼ˆ`MemTable`ï¼‰è¾“å‡ºåˆ°ç£ç›˜çš„`Minor Compaction`æœºåˆ¶å®ç°çš„ã€‚åŒæ—¶åˆ©ç”¨å±€éƒ¨æ€§åŸç†æœ€è¿‘å†™å…¥çš„æ•°æ®ä¼šä¿ç•™åœ¨å†…å­˜è¡¨ä¸­ï¼Œä»¥ä¾¿å¿«é€Ÿè®¿é—®ã€‚è¿™æ ·å¯ä»¥å‡å°‘å¯¹ç£ç›˜çš„ç›´æ¥è®¿é—®ï¼Œæé«˜æ•°æ®è¯»å–é€Ÿåº¦ã€‚å¹¶ä¸”ï¼Œå¯¹äºä¸å­˜åœ¨çš„è¡Œé”®æŸ¥è¯¢ï¼Œ`Bigtable`ä½¿ç”¨å†…å­˜ä¸­çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆ`BloomFilter`ï¼‰è¿›è¡Œå¿«é€Ÿè¿‡æ»¤ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä¸å¿…è¦çš„ç£ç›˜éšæœºè®¿é—®æ¬¡æ•°ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚

![image](https://github.com/user-attachments/assets/f4bd50be-e8cc-40e9-96d1-3de4a4fa8885)


`MemTable` çš„æ•°æ®ç»“æ„é€šå¸¸æ˜¯é€šè¿‡ä¸€ä¸ª `AVL` çº¢é»‘æ ‘ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ª `Skip List` æ¥å®ç°çš„ã€‚è€Œ Bigtable çš„ `MemTable` å’Œ `SSTable` çš„æºç ï¼Œä¸€èˆ¬è¢«è®¤ä¸ºå°±æ˜¯ç”± Google å¼€æºçš„ `LevelDB` æ¥å®ç°çš„ã€‚åœ¨å®é™…çš„ `LevelDB` æºç ä¸­ï¼Œ`MemTable` æ˜¯é€‰æ‹©ä½¿ç”¨ `Skip List` æ¥ä½œä¸ºè‡ªå·±çš„æ•°æ®ç»“æ„ã€‚ä¹‹æ‰€ä»¥é‡‡ç”¨è¿™ä¸ªæ•°æ®ç»“æ„ï¼ŒåŸå› ä¹Ÿå¾ˆç®€å•ï¼Œä¸»è¦æ˜¯å› ä¸º `MemTable` åªæœ‰ä¸‰ç§æ“ä½œï¼š

1. **éšæœºæ•°æ®æ’å…¥**ï¼šç¬¬ä¸€ç§æ˜¯æ ¹æ®è¡Œé”®çš„éšæœºæ•°æ®æ’å…¥ï¼Œè¿™ä¸ªåœ¨æ•°æ®å†™å…¥çš„æ—¶å€™éœ€è¦ç”¨åˆ°ï¼›
2. **éšæœºæ•°æ®è¯»å–**ï¼šç¬¬äºŒç§æ˜¯æ ¹æ®è¡Œé”®çš„éšæœºæ•°æ®è¯»å–ï¼Œè¿™ä¸ªåœ¨æ•°æ®è¯»å–çš„æ—¶å€™éœ€è¦ç”¨åˆ°ï¼›
3. **æœ‰åºéå†**ï¼šæœ€åä¸€ç§æ˜¯æ ¹æ®è¡Œé”®æœ‰åºéå†ï¼Œè¿™ä¸ªåœ¨æˆ‘ä»¬æŠŠ `MemTable` è½¬åŒ–æˆ `SSTable` çš„æ—¶å€™ä¼šè¢«ç”¨åˆ°ã€‚

`AVL` çº¢é»‘æ ‘å’Œ `Skip List` åœ¨è¿™ä¸‰ç§æ“ä½œä¸Šï¼Œæ€§èƒ½éƒ½å¾ˆå¥½ï¼Œéšæœºæ’å…¥å’Œè¯»å–çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ `O(logN)`ï¼Œè€Œæœ‰åºéå†çš„æ—¶é—´å¤æ‚åº¦ï¼Œåˆ™æ˜¯ `O(N)`ã€‚



![image](https://github.com/user-attachments/assets/0dc45e08-bb84-44f4-b1ac-ffce3ad064fd)


å½“`MemTable`çš„å¤§å°è¶…å‡ºé¢„è®¾é˜ˆå€¼ä¹‹åï¼Œæˆ‘ä»¬ä¼šè¿›è¡Œä¸€æ¬¡è½¬æ¢è¿‡ç¨‹ï¼Œå°†å…¶å˜æˆä¸€ä¸ªåä¸º`SSTable`çš„æ–‡ä»¶ã€‚`SSTable`çš„æ–‡ä»¶æ ¼å¼å…¶å®éå¸¸ç®€æ´æ˜äº†ï¼Œå®ƒä¸»è¦åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼š


1. **æ•°æ®å—ï¼ˆData Blockï¼‰**ï¼š
   - ç¬¬ä¸€éƒ¨åˆ†æ˜¯å®é™…å­˜å‚¨çš„æ•°æ®ï¼ŒåŒ…æ‹¬è¡Œé”®ã€åˆ—ã€å€¼ä»¥åŠæ—¶é—´æˆ³ã€‚è¿™äº›æ•°æ®æŒ‰ç…§è¡Œé”®çš„é¡ºåºæ’åºï¼Œå¹¶è¢«åˆ†å‰²æˆå›ºå®šå¤§å°çš„å—è¿›è¡Œå­˜å‚¨ã€‚åœ¨SSTableä¸­ï¼Œè¿™éƒ¨åˆ†å†…å®¹è¢«ç§°ä¸ºæ•°æ®å—ã€‚æ•°æ®å—çš„è®¾è®¡å…è®¸é«˜æ•ˆåœ°å­˜å‚¨å’Œæ£€ç´¢ç»“æ„åŒ–æ•°æ®ï¼ŒåŒæ—¶ä¿æŒæ•°æ®çš„æœ‰åºæ€§ï¼Œè¿™å¯¹äºèŒƒå›´æŸ¥è¯¢å’Œéšæœºè®¿é—®éƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚

2. **å…ƒæ•°æ®å’Œç´¢å¼•ä¿¡æ¯**ï¼š
   - ç¬¬äºŒéƒ¨åˆ†åŒ…å«ä¸€ç³»åˆ—çš„å…ƒæ•°æ®å’Œç´¢å¼•ä¿¡æ¯ã€‚å…¶ä¸­åŒ…æ‹¬ç”¨äºå¿«é€Ÿè¿‡æ»¤æ‰SSTableä¸­ä¸å­˜åœ¨çš„è¡Œé”®çš„`Bloom Filter`ï¼Œä»¥åŠåŒ…å«æ•´ä¸ªæ•°æ®å—çš„ä¸€äº›ç»Ÿè®¡æŒ‡æ ‡ï¼Œè¿™äº›ç»Ÿç§°ä¸ºå…ƒæ•°æ®å—ï¼ˆMeta Blockï¼‰ã€‚
   - å¦å¤–ï¼Œè¿˜æœ‰é’ˆå¯¹æ•°æ®å—å’Œå…ƒæ•°æ®å—çš„ç´¢å¼•ï¼Œåˆ†åˆ«ä¸ºå…ƒæ•°æ®ç´¢å¼•å—ï¼ˆMetaindex Blockï¼‰å’Œæ•°æ®ç´¢å¼•å—ï¼ˆIndex Blockï¼‰ã€‚è¿™äº›ç´¢å¼•ä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿå¿«é€Ÿå®šä½åˆ°å…·ä½“çš„æ•°æ®å—ï¼Œæå¤§åœ°æé«˜äº†æ•°æ®æ£€ç´¢çš„æ•ˆç‡ã€‚


`SSTable`çš„æ•°æ®é¡ºåºå­˜å‚¨ç®€åŒ–äº†`Major Compaction`è¿‡ç¨‹ï¼Œåªéœ€è¿›è¡Œå¤šè·¯å½’å¹¶æ’åºï¼Œæœ‰æ•ˆå‡å°‘äº†éšæœºç¡¬ç›˜è®¿é—®ï¼Œæå‡äº†è¯»å†™æ•ˆç‡ã€‚åœ¨æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ©ç”¨ç´¢å¼•å®šä½åˆ°æ•°æ®å—ï¼Œç„¶åä»ä¸­æå–æ‰€éœ€çš„`KV`æ•°æ®ï¼Œå¹¶å°†å…¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯¹å‹ç¼©å’Œç¼“å­˜æœºåˆ¶è¿›è¡Œäº†ä¼˜åŒ–ï¼šé€šè¿‡å‹ç¼©ç®—æ³•ï¼Œæˆ‘ä»¬ç‰ºç‰²ä¸€å®šçš„CPUèµ„æºæ¥å‡å°‘å­˜å‚¨å’Œç¼“å­˜ç©ºé—´çš„éœ€æ±‚ã€‚`SSTable`ä¸­çš„`å¸ƒéš†è¿‡æ»¤å™¨`è¢«ç¼“å­˜åœ¨`Tablet Server`ä¸­ï¼Œä»¥ä¾¿å¿«é€Ÿåˆ¤æ–­è¡Œé”®æ˜¯å¦å­˜åœ¨ã€‚`Bigtable`å®ç°äº†ä¸¤çº§ç¼“å­˜æœºåˆ¶ï¼š`Scan Cache`ç”¨äºç¼“å­˜æŸ¥è¯¢ç»“æœï¼Œè€Œ`Block Cache`åˆ™ç¼“å­˜æ•´ä¸ªæ•°æ®å—ï¼Œè¿™ä¸¤è€…éƒ½æé«˜äº†æ•°æ®è®¿é—®çš„æ•ˆç‡ã€‚è¿™äº›ç¼“å­˜æœºåˆ¶ä¸å—æ–°å†™å…¥æ•°æ®çš„å½±å“ï¼Œå› ä¸ºæ–°æ•°æ®è¢«å­˜å‚¨åœ¨`MemTable`ä¸­ï¼Œä¸ä¼šå¹²æ‰°`SSTable`çš„ç¼“å­˜ã€‚


## 3. å†™åœ¨æœ€å




ç»¼ä¸Šæ‰€è¿°ï¼ŒBigtableè®ºæ–‡åœ¨å¤§æ•°æ®é¢†åŸŸäº§ç”Ÿäº†æ·±è¿œçš„å½±å“ï¼Œå…¶è®¾è®¡ç†å¿µä¹Ÿå½±å“äº†å¼€æºç¤¾åŒºï¼Œå®ƒä¸ä»…ä¿ƒè¿›äº†NoSQLæ•°æ®åº“çš„å…´èµ·ï¼Œè¿˜å¯¹è®¸å¤šåæ¥çš„å¤§æ•°æ®æŠ€æœ¯ç»„ä»¶äº§ç”Ÿäº†ç›´æ¥çš„å¯å‘ï¼ŒåŒ…æ‹¬HBaseã€MongoDBå’ŒSparkç­‰ã€‚



æ›´é‡è¦çš„æ˜¯ï¼Œä¸ä»…ä»…æ˜¯ä¸€ç¯‡å­¦æœ¯è®ºæ–‡ï¼Œå®ƒæ›´åƒæ˜¯ä¸€æœ¬å®è·µæŒ‡å—ï¼ŒæŒ‡å¯¼æˆ‘ä»¬åœ¨å®é™…å·¥ä½œä¸­å¦‚ä½•æ›´æœ‰æ•ˆåœ°å­˜å‚¨å’Œå¤„ç†æ•°æ®ã€‚

æœ€åï¼Œç”±äºç¯‡å¹…é™åˆ¶ï¼Œä¸€äº›æ•°æ®éªŒè¯çš„æ·±å…¥è®¨è®ºå¹¶æœªåœ¨æ­¤å±•å¼€ã€‚å¯¹äºæœ‰å…´è¶£è¿›ä¸€æ­¥æ¢ç´¢çš„è¯»è€…ï¼Œæˆ‘å»ºè®®ç²¾è¯»å…¨æ–‡ä»¥è·å¾—æ›´å…¨é¢çš„äº†è§£ã€‚


è·å–åŸæ–‡

 - GItHubï¼š[https://github.com/hiszm/BigDataWeekly/tree/main/èµ„æ–™](https://github.com/hiszm/BigDataWeekly/tree/main/%E8%B5%84%E6%96%99) 
 - å…¬ä¼—å·å›å¤ï¼š004






å¦‚æœä½ æƒ³å‚ä¸è®¨è®ºï¼Œè¯· ç‚¹å‡»è¿™é‡Œ[ğŸ‘‰https://github.com/hiszm/BigDataWeekly](https://github.com/hiszm/BigDataWeekly)ï¼Œæ¯å‘¨éƒ½æœ‰æ–°çš„ä¸»é¢˜ï¼Œå‘¨æœ«æˆ–å‘¨ä¸€å‘å¸ƒã€‚

**å¤§æ•°æ®ç²¾è¯»ï¼Œæ¢ç´¢çŸ¥è¯†çš„æ·±åº¦ã€‚**

> å…³æ³¨ **å¤§æ•°æ®ç²¾è¯»å‘¨åˆŠ** å¾®ä¿¡å…¬ä¼—å·
> ![image](https://github.com/user-attachments/assets/cd8ff7f8-e1fe-41b9-9be1-e2ae55ff6c8c)






ç‰ˆæƒå£°æ˜ï¼šè‡ªç”±è½¬è½½-éå•†ç”¨-éè¡ç”Ÿ-ä¿æŒç½²åï¼ˆ[åˆ›æ„å…±äº« 3.0 è®¸å¯è¯](https://creativecommons.org/licenses/by-nc-nd/3.0/deed.en)ï¼‰
